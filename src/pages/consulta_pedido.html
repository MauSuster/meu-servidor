<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Estoque API</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <li id="voltar"><a href="/">Voltar</a></li>
  <h1>Consulta de Estoque</h1>
  <input type="text" id="codigoVendedor" placeholder="Digite o c√≥digo vendedor">
  <button id="btnRequisicao">Consultar Pedido de Venda</button>
  
  <table border="1">
    <thead>
      <tr>
        <th>Filial</th>
        <th>N√∫mero</th>
        <th>Cliente</th>
        <th>Nome</th>
        <th>Data</th>
        <th>Transportadora</th>
        <th>Vendedor</th>
        <th>A√ß√£o</th> <!-- Nova coluna para o √≠cone de a√ß√£o -->
      </tr>
    </thead>
    <tbody id="tabelaPedidos"></tbody>
  </table>
  
  <script>
    document.getElementById('btnRequisicao').addEventListener('click', () => {
      const vendedor = document.getElementById('codigoVendedor').value.trim();
      if (!vendedor) {
        alert("Digite um c√≥digo de pedido!");
        return;
      }

      fetch(`/api/pedido?vendedor=${vendedor}`)
        .then(response => response.json())
        .then(data => {
          const tabela = document.getElementById('tabelaPedidos');
          
          // Limpa a tabela antes de adicionar novos dados
          tabela.innerHTML = ""; 

          // Verifica se a resposta cont√©m dados v√°lidos
          if (!Array.isArray(data)) {
            alert("Erro ao processar os dados recebidos.");
            return;
          }

          const indicesDesejados = [0, 1, 2, 3, 4, 5, 6];

          // Adiciona cada item como uma linha na tabela
          data.forEach(item => {
            const row = document.createElement('tr');

            indicesDesejados.forEach((index, i) => {
              const td = document.createElement('td');

              // Verifica se √© o quinto valor (√≠ndice 4) e formata a data
              if (index === 4 && item[index]) {
                const dataStr = item[index].toString(); // Converte para string (caso seja num√©rico)
                if (dataStr.length === 8) { // Garante que tem o formato correto
                  const dataFormatada = `${dataStr.substring(6, 8)}/${dataStr.substring(4, 6)}/${dataStr.substring(0, 4)}`;
                  td.innerText = dataFormatada;
                } else {
                  td.innerText = item[index]; // Caso n√£o seja um formato esperado, mant√©m o original
                }
              } else {
                td.innerText = item[index] !== undefined ? item[index] : '-'; // Se n√£o houver dado, coloca "-"
              }

              row.appendChild(td);
            });

            // Adiciona a √∫ltima c√©lula com o √≠cone clic√°vel
            const actionTd = document.createElement('td');
            const link = document.createElement('a');
            link.href = `/pedido/${item[1]}`; // O n√∫mero do pedido (√≠ndice 1)
            link.innerHTML = 'üîç'; // √çcone de lupa
            link.style.textDecoration = 'none'; // Remove sublinhado padr√£o

            actionTd.appendChild(link);
            row.appendChild(actionTd);

            tabela.appendChild(row);
          });
        })
        .catch(error => {
          console.error('Erro na requisi√ß√£o:', error);
          alert("Erro ao consultar estoque.");
        });

        fetch(`/api/estoque?produto=${produto}`)
        .then(response => response.json())
        .then(data => {
          const tabela = document.getElementById('tabelaEstoque');
          const produtoNome = document.getElementById('produtoNome');
          
          // Limpa a tabela antes de adicionar novos dados
          tabela.innerHTML = ""; 

          // Verifica se a resposta cont√©m dados v√°lidos
          if (!Array.isArray(data)) {
            alert("Erro ao processar os dados recebidos.");
            return;
          }

          produtoNome.innerText = data[0][1] || "Produto n√£o encontrado";

          const indicesDesejados = [0, 2, 4, 5, 6, 7, 8, 9, 10]; 
          // Adiciona cada item como uma linha na tabela
          data.forEach(item => {
        const row = document.createElement('tr');

        indicesDesejados.forEach(index => {
          const td = document.createElement('td');
          td.innerText = item[index] !== undefined ? item[index] : '-'; // Se n√£o houver dado, coloca "-"
          row.appendChild(td);
        });

        tabela.appendChild(row);
        
      });
        })
        .catch(error => {
          console.error('Erro na requisi√ß√£o:', error);
          alert("Erro ao consultar estoque.");
        });

    });
  </script>
</body>
</html>
